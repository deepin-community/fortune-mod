#! /usr/bin/make -f

binary binary-arch binary-indep build build-arch build-indep clean:
	dh $@

# Build with prefix="" to generate correct embedded paths.
override_dh_auto_build-arch:
	dh_auto_build -- fortune-bin util-bin
	dh_auto_build -- fortune/fortune.man
override_dh_auto_build-indep:
	dh_auto_build -- cookies-z

# Install to debian/tmp.
override_dh_auto_install-indep:
	dh_auto_install -- prefix=$(CURDIR)/debian/tmp install-cookie
override_dh_auto_install-arch:
	dh_auto_install -- prefix=$(CURDIR)/debian/tmp \
          install-fortune install-util install-man

# Clean objects generated by the patched Makefiles, even if the tree
# is not patched anymore. See
# debian/patches/simplify_build_system.diff
override_dh_auto_clean:
	dh_auto_clean
	rm -rf datfiles/gen datfiles/off/gen

# Split cookie lists into fortunes, fortunes-min and fortunes-off
# packages.
DIR := usr/share/games/fortunes
MIN := $(foreach min,fortunes literature riddles,$(min) $(min).u8 $(min).dat)
override_dh_install-indep:
	dh_install --package=fortunes-off $(DIR)/off $(DIR)
	dh_install --package=fortunes-min $(addprefix $(DIR)/,$(MIN)) $(DIR)
	cd debian/tmp/$(DIR) && rm -rf off $(MIN)
	dh_install --package=fortunes $(DIR)
	dh_install --remaining-packages

override_dh_installchangelogs:
	dh_installchangelogs ChangeLog
